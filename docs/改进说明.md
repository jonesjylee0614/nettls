# 改进说明

## 问题修复与功能增强 (2025-11-12)

### 最新改进 (第二轮)

#### 4. 清理多余的 Profile
**问题**: profiles 目录下有 example.json 和 home.json 两个文件
**解决**: 删除 example.json,只保留 home.json 作为唯一的默认 profile

#### 5. 添加路由系统状态显示
**问题**: 
- 无法直观看到哪些配置路由已经在系统中生效
- 需要手动切换标签页对比

**解决**: 
- 在配置路由表格中新增"系统状态"列
- 实时检查每个配置路由是否存在于系统路由表中
- 用颜色标识状态:
  - **绿色 "✓ 已存在"**: 该路由已在系统中生效
  - **灰色 "未应用"**: 该路由还未应用到系统

**特性**:
- 启动后立即可见哪些路由已生效
- 无需切换标签页即可了解路由状态
- 自动匹配目标和网关进行智能判断

## 第一轮改进

### 1. 修复导入错误
**问题**: `route_dialog.py` 缺少 `Tuple` 类型导入，导致启动时出现 `NameError`
**解决**: 在文件开头添加 `from typing import Tuple`

### 2. 优化启动速度
**问题**: 启动时同步执行网络接口和系统路由刷新，导致启动缓慢
**解决**: 
- 使用 `QTimer.singleShot(100, self._delayed_refresh)` 延迟刷新
- 窗口先显示，然后异步加载数据
- 启动时显示"正在加载..."状态提示

**效果**: 
- 窗口立即显示，用户体验更流畅
- 避免启动时的卡顿感

### 3. 添加系统路由显示功能
**问题**: 
- 界面只显示配置文件中的路由
- 无法查看系统当前实际存在的路由
- `route_manager.refresh_system_routes()` 获取的系统路由没有展示

**解决**: 
- 重构主窗口，使用 `QTabWidget` 创建两个标签页
  - **配置路由**: 显示配置文件中的路由（原有功能）
  - **系统路由**: 显示系统中实际存在的所有路由（新功能）
  
- 系统路由标签页包含:
  - 刷新按钮：手动刷新系统路由
  - 路由统计：显示系统路由总数
  - 路由表格：显示目标、网关、接口索引、Metric、协议等信息

**特性**:
- 自动刷新：切换到系统路由标签页时自动刷新
- 只读显示：系统路由表格为只读，防止误操作
- 实时更新：F5 刷新或点击刷新按钮都会更新系统路由

### 4. Profile 默认行为说明
**现状**: 
- 启动时默认加载 `home.json` profile
- 如果不存在会自动创建
- 这是正常的设计行为

**建议**: 
- 用户可以通过 Profile 管理功能创建多个 profile
- 通过工具栏的 Profile 下拉菜单切换不同配置

## 使用说明

### 查看系统路由
1. 启动程序后，点击"系统路由"标签页
2. 自动显示系统中所有 IPv4 路由
3. 点击"刷新系统路由"按钮可手动更新

### 对比配置与系统路由
- **配置路由**标签页：您想要应用的路由配置
- **系统路由**标签页：系统中实际生效的路由
- 应用配置后，可以切换到系统路由标签页验证是否生效

## 技术细节

### 修改的文件
- `src/ui/dialogs/route_dialog.py` - 添加 Tuple 导入
- `src/ui/main_window.py` - 重构主窗口，添加标签页和系统路由显示

### 新增方法
- `_delayed_refresh()` - 延迟刷新，优化启动速度
- `_create_config_routes_tab()` - 创建配置路由标签页
- `_create_system_routes_tab()` - 创建系统路由标签页
- `_update_system_routes_table()` - 更新系统路由表格
- `_on_tab_changed()` - 标签页切换事件处理
- `_on_refresh_system_routes()` - 刷新系统路由事件处理

### 性能优化
- 启动时延迟 100ms 后再执行数据刷新
- 系统路由仅在切换到对应标签页时刷新
- 避免不必要的 PowerShell 命令执行

## 测试建议

1. 启动程序，观察启动速度是否改善
2. 切换到"系统路由"标签页，查看当前系统路由
3. 在"配置路由"中添加新路由并应用
4. 切换到"系统路由"验证路由是否生效
5. 使用 F5 刷新，确认两个标签页都正确更新

