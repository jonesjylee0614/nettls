# 路由掩码使用说明

## 问题场景

当您需要为多个相邻IP地址添加路由时，例如：
- `103.235.46.115`
- `103.235.46.112`
- `103.235.46.xxx` （更多同网段IP）

与其为每个IP单独添加路由，可以使用**网段路由**来一次性覆盖整个范围。

## 解决方案

### 方案一：使用 CIDR 网段（推荐）

在"目标地址"字段输入网段格式：

```
103.235.46.0/24
```

**说明：**
- `103.235.46.0` - 网段起始地址
- `/24` - 前缀长度，表示前24位是网络位
- 相当于掩码 `255.255.255.0`
- 覆盖范围：`103.235.46.0` ~ `103.235.46.255`（共256个IP）

### 方案二：使用更小的网段

如果只需要覆盖部分IP（如 100-127），可以使用更精确的前缀：

```
103.235.46.96/27
```

**常用前缀长度对照表：**

| 前缀 | 掩码 | IP数量 | 范围示例 |
|------|------|--------|----------|
| /32 | 255.255.255.255 | 1 | 单个IP |
| /31 | 255.255.255.254 | 2 | 点对点链路 |
| /30 | 255.255.255.252 | 4 | x.x.x.0-3 |
| /29 | 255.255.255.248 | 8 | x.x.x.0-7 |
| /28 | 255.255.255.240 | 16 | x.x.x.0-15 |
| /27 | 255.255.255.224 | 32 | x.x.x.0-31 |
| /26 | 255.255.255.192 | 64 | x.x.x.0-63 |
| /25 | 255.255.255.128 | 128 | x.x.x.0-127 |
| /24 | 255.255.255.0 | 256 | x.x.x.0-255 |
| /16 | 255.255.0.0 | 65536 | x.x.0.0-x.x.255.255 |

## 实际操作步骤

### 1. 新增路由

1. 点击"新增路由"按钮
2. 在"目标地址"输入：`103.235.46.0/24`
3. 程序会自动：
   - 识别为网段格式
   - 计算前缀长度为 24
   - 显示掩码为 255.255.255.0
4. 选择网关和接口
5. 添加描述：如"阿里云网段"
6. 保存并应用

### 2. 验证路由

添加后，以下IP都会使用这条路由：
- ✅ `103.235.46.1`
- ✅ `103.235.46.112`
- ✅ `103.235.46.115`
- ✅ `103.235.46.255`

## 注意事项

### ⚠️ 避免路由冲突

如果您已经有单个IP的路由（如 `/32`），再添加网段路由（如 `/24`），会产生冲突。

**解决方法：**
1. 删除单个IP路由
2. 只保留网段路由
3. 网段路由会自动覆盖范围内的所有IP

### 🔍 WireGuard 全隧道警告

如果您使用 WireGuard 全隧道模式（`0.0.0.0/1` + `128.0.0.0/1`），建议：
- 白名单使用 `/32` 精确匹配
- 避免使用过大的网段（如 `/16`、`/8`）

## 高级技巧

### 计算网段范围

如果不确定前缀长度，可以使用在线计算器：
- [CIDR Calculator](https://www.subnet-calculator.com/)
- [IP Subnet Calculator](https://www.calculator.net/ip-subnet-calculator.html)

### 常见应用场景

1. **云服务器网段**
   ```
   39.104.0.0/16  (阿里云某地域)
   ```

2. **办公室内网**
   ```
   192.168.1.0/24  (办公室网络)
   ```

3. **VPN网段**
   ```
   10.8.0.0/24  (OpenVPN默认)
   ```

4. **特定服务网段**
   ```
   8.8.8.0/29  (Google DNS及相关服务)
   ```

## 工具中的掩码显示

在路由管理工具中：
- **统一路由表**：显示完整CIDR格式（如 `103.235.46.0/24`）
- **命令预览**：显示Windows命令格式
  ```
  route ADD 103.235.46.0 MASK 255.255.255.0 192.168.1.1 IF 10
  ```
- **系统路由表**：Windows使用掩码表示，程序会自动转换

## 总结

✅ **推荐做法：**
- 使用CIDR格式输入网段：`103.235.46.0/24`
- 程序自动处理掩码转换
- 无需手动输入掩码

❌ **不推荐：**
- 为每个IP单独添加路由
- 会造成路由表臃肿
- 维护困难

---

**最后更新：** 2025-11-12  
**适用版本：** NetTLS Route Manager v2.0+

